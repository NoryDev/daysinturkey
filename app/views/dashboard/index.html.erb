<%= content_for(:title) do %>
  Visa Countdown
<% end %>

<%= content_for(:description) do %>
  The Schengen area and Turkey are among the countries in which many foreigners can stay with a tourist visa for 90 days in ANY 180 days period. Calculate when you must leave or when you can re-enter.
<% end %>

<div class="container">
  <div class="row">
    <div class="col-md-6">
      <% @user.destinations.order(:zone).each do |destination| %>
      <div class="col-md-6">
        <h4><%= destination %></h4>
          <ul class="list-group">
            <% if destination.latest_entry && destination.latest_entry <= Date.current %>
              <%= render 'periods/one_period', start: date_format(destination.latest_entry), stop: "ongoing", count: (Date.current - destination.latest_entry).to_i + 1, destination: destination, period: nil %>
            <% elsif destination.latest_entry && destination.latest_entry > Date.current %>
              <%= render 'periods/one_period', start: date_format(destination.latest_entry), stop: "", count: "X", destination: destination, period: nil %>
            <% else %>
              <li class="list-group-item">
                <div class="row text-center">
                  <small><%= link_to 'Add latest or planned entry', edit_destination_path(destination) %></small>
                </div>
              </li>
            <% end %>

          <% destination.periods.order(last_day: :desc).each do |period| %>
            <%= render 'periods/one_period', period: period, start: date_format(period.first_day), stop: date_format(period.last_day), count: (period.last_day - period.first_day).to_i + 1 %>
          <% end %>
          <li class="list-group-item">
            <div class="row text-center">
              <small><%= link_to 'Add a period', new_period_path %></small>
            </div>
          </li>
        </ul>

        <%= user_policy_for(destination) %>

        <% if destination.countdown %>
          <%= display_countdown_for(destination) %>
        <% end %>
      </div>
    <% end %>
    </div>
    <div class="col-md-6">
      <p>
        <strong>your citizenship:</strong> <%= @user.citizenship %>
        <%= link_to edit_user_path(@user) do %>
          <i class="fa fa-pencil"></i>
        <% end %>
      </p>
    </div>
  </div>
</div>