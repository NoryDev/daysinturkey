<%= content_for(:title) do %>
  Visa Countdown
<% end %>

<%= content_for(:description) do %>
  The Schengen area, Turkey and Russia are among the countries in which many foreigners can stay with a tourist visa 90 days in ANY 180 days period. Calculate when you must leave or when you can re-enter.
<% end %>

<div class="container-fluid">
  <div class="row">
    <div class="col-xs-10 col-xs-offset-1 col-lg-8 col-lg-offset-2">
      <!-- <h4>Turkey Clock: <%#= @time_now %></h4> -->

        <!-- Results -->
        <% if @user.latest_entry %>
          <div id="results" class="bg-info marged">


            <p>
              In the last 180 days, you spent <strong><%= @time_spent_today %></strong> days in Turkey.
            </p>

            <% case @situation %>
            <%   when "inside_ok" %>
              <p>You entered on <strong><%= @latest_entry %></strong></p>
              <p>You can stay <strong><%= @remaining_time %></strong> more days.</p>
              <p>You must leave on <strong><%= @leave_on %></strong> or before.</p>
            <%   when "outside_ok" %>
              <p>You plan to enter on <strong><%= @latest_entry %></strong></p>
              <p>You will be able to stay: <strong><%= @remaining_time %></strong> days</p>
              <p>You will have to leave on <strong><%= @leave_on %></strong> or before</p>
            <%   when "overstay" %>
              <p class="marged bg-red"><i class="fa fa-exclamation-triangle fa-2x pull-left"></i><strong> You are in overstay! Get out of here as soon as you can to avoid paying more penalty!</strong></p>
            <%   when "quota_used" %>
              <p>You used your quota of days. Next time you can enter is on <strong><span><%= @next_entry.strftime("%B %d, %Y") %></span></strong>.

                <% if !@can_enter %>
                  You would be able to stay <strong><%= @remaining_time %></strong> days and would have to leave on <strong><%= @leave_on %></strong> or before.
                <% end %>
              </p>

              <p>You plan to enter on <strong><%= @latest_entry %></strong> which is
                <% if @can_enter %>
                  <span class="label label-success">OK</span>
                  </p>
                  <p>You will be able to stay <strong><%= @remaining_time %></strong> days.</p>
                  <p>You will have to leave on <strong><%= @leave_on %></strong> or before.</p>
                <% else %>
                  <span class="label label-danger">NOT OK - you will be denied entry</span> <i class="fa fa-arrow"></i>
                <% end %>
              </p>
            <% end %>
          </div>
        <% end %>
        <!-- Results -->

        <!-- All previous stays -->
        <div id="all_stays" class="padded">

          <strong>Please enter all your stays in Turkey between <%= @oldest_date %> (included) and your latest or planned entry (not included)</strong>

          <div class="mini-padded">
            <table class="table tablebordered table-condensed">
              <thead>
                <tr>
                  <th>Entry Date</th>
                  <th>Exit Date</th>
                  <th>Number of Days</th>
                  <th></th>
                </tr>
              </thead>
              <tbody>
                <% if @periods.empty? %>
                  <tr id="no_periods"><td class="active" colspan="4">You did not enter any stay yet</td></tr>
                <% end %>
                <%= render "periods/all_periods", periods: @periods %>
              </tbody>
            </table>
          </div>

          <div id="new_period_form">
            <label>Add a stay</label>
            <%= render "periods/form", period: Period.new() %>
          </div>

        </div>
        <!-- All previous stays -->

        <!-- User is in? -->
        <%= form_for(@user, url: users_latest_entry_path) do |f| %>
          <div class="form-group" id="inside_last_entry">
            <label for="last_entry">Latest or planned Entry</label>
            <%= f.text_field :latest_entry, id: "user_last_entry", class: "form-control latest_planned", placeholder: "Click to Select", value: @latest_entry, required: "required" %>
          </div>

          <button id="calculate" type="submit" class="btn btn-success" disabled="disabled">Calculate</button>
        <% end %>
        <!-- User is in? -->

        <div id="disclaimer" class="marged bg-info">
          <small>
            <p><strong>Disclaimer</strong></p>
            <p>With our Visa Calculator, you can enter all the information about your past and projected trip days, and figure out if you are following the rules and not overstaying on your trips in Turkey.</p>

            <p>Our service is provided as is. It is not linked in any way to any official authorities. We will not accept any liability for any negative effects of any nature its use may have.</p>

            <p><strong>Credit</strong></p>
            <p>Logo: Created by Yazmin Alanis, from the Noun Project</p>
          </small>
        </div>

    </div>
  </div>
</div>