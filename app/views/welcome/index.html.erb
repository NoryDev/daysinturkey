<%= content_for(:title) do %>
  Days in Turkey
<% end %>

<%= content_for(:description) do %>
  With a tourist visa you can stay in Turkey 90 days every 180 days. When should you leave? Make the math!
<% end %>

<div class="container-fluid">
  <div class="row">
    <div class="col-xs-10 col-xs-offset-1 col-lg-8 col-lg-offset-2">

      <h4>Turkey Clock: <%= @time_now %></h4>

        <!-- Results -->
        <% if @user.latest_entry %>
          <% if @user.is_in_turkey? %>
            <% if @user.time_spent(@today) > 90 %>
              <p>
                time spent in the last 180 days: <span id="time_spent"><%= @user.time_spent(@today) %></span>
              </p>
              <p><strong>You are in overstay! Get out of here as soon as you can to avoid paying more penalty!</strong></p>
            <% else %>
              <p>
                time spent in the last 180 days: <span id="time_spent"><%= @user.time_spent(@today) %></span>
              </p>
              <p>
                remaining days: <span id="remaining_time"><%= @user.remaining_time %></span>
              </p>
              <p>
                You must leave on <span id="leave_on"><%= @user.latest_exit %></span> or before
              </p>
            <% end %>
          <% else %>
            <% if @user.time_spent(@today) >= 90 %>
              <p>
                time spent in the last 180 days: <span id="time_spent"><%= @user.time_spent(@today) %></span>
              </p>
              <p>You used your quota of days. Next time you can enter is on <span><%= @user.next_entry %></span></p>
            <% else %>
              <p>
                time spent in the last 180 days: <span id="time_spent"><%= @user.time_spent(@today) %></span>
              </p>
              <p>
                You will be able to stay: <span id="remaining_time"><%= @user.remaining_time %></span> days
              </p>
              <p>
                You will have to leave on <span id="leave_on"><%= @user.latest_exit %></span> or before
              </p>
            <% end %>
          <% end %>
        <% end %>
          <!-- Results -->

        <!-- All previous stays -->
        <strong>Please enter all your stays in Turkey since <%= @oldest_date %> (included) and your planned stays before planned entry</strong>
        <p><small>Example: you plan to enter on <%= (@today + 20).strftime("%B %d, %Y") %> and plan a trip between <%= (@today + 5).strftime("%B %d, %Y") %> and <%= (@today + 10).strftime("%B %d, %Y") %></small></p>
        <div id="all_stays">
          <table class="table tablebordered table-condensed">
            <thead>
              <tr>
                <td>Entry Date</td>
                <td>Exit Date</td>
                <td>Number of Days</td>
              </tr>
            </thead>
            <tbody>
              <%= render "periods/all_periods", periods: @periods %>
            </tbody>
          </table>
          <div id="new_period_form">
            <%= render "periods/form", period: Period.new() %>
          </div>
        </div>
        <!-- All previous stays -->

        <!-- User is in? -->
        <%= form_for(@user, url: users_latest_entry_path) do |f| %>
          <div class="form-group" id="inside_last_entry">
            <label for="last_entry">Latest/Planned Entry</label>
            <%= f.text_field :latest_entry, id: "user_last_entry", class: "form-control latest_planned", placeholder: "Click to Select", value: @latest_entry, required: "required" %>
          </div>

          <button if="calculate" type="submit" class="btn btn-success">Calculate</button>
        <% end %>
        <!-- User is in? -->

    </div>
  </div>
</div>