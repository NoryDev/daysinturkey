<%= content_for(:title) do %>
  Days in Turkey
<% end %>

<%= content_for(:description) do %>
  With a tourist visa you can stay in Turkey 90 days every 180 days. When should you leave? Make the math!
<% end %>

<div class="container-fluid">
  <div class="row">
    <div class="col-xs-10 col-xs-offset-1 col-lg-8 col-lg-offset-2">
      <h4>Turkey Clock: <%= @time_now %></h4>

        <!-- Results -->
        <% if @user.latest_entry %>
          <div id="results" class="bg-info marged">
            <p>In the last 180 days, you spent <strong><span id="time_spent"><%= @user.time_spent(@today) %></span></strong> days in Turkey.</p>
            <% if @user.is_in_turkey? %>
              <% if @user.time_spent(@today) > 90 %>
                <div id="should-leave">
                  <p class="marged bg-red"><i class="fa fa-exclamation-triangle fa-2x pull-left"></i><strong> You are in overstay! Get out of here as soon as you can to avoid paying more penalty!</strong></p>
                </div>
              <% else %>
                <p>You entered on <strong><%= @user.latest_entry.strftime("%B %d, %Y") %></strong></p>
                <p>You can stay <strong><span id="remaining_time"><%= @user.remaining_time %></span></strong> more days.</p>
                <p>You must leave on <strong><span id="leave_on"><%= @user.latest_exit %></span></strong> or before.</p>
              <% end %>
            <% else %>
              <% if @user.time_spent(@today) >= 90 %>


                <p>You used your quota of days. Next time you can enter is on <strong><span><% next_e = @user.next_entry %><%= next_e.strftime("%B %d, %Y") %></span></strong>.

                  <% if (@user.latest_entry - next_e).to_i < 0 %>

                  You would be able to stay <strong><span id="remaining_time"><% next_rt = @user.remaining_time(next_e, true) %><%= next_rt %></span></strong> days and would have to leave on <strong><span id="leave_on"><%= (next_e + next_rt - 1).strftime("%B %d, %Y") %></span></strong> or before.
                  <% end %>
                </p>

                <p>You plan to enter on <strong><%= @user.latest_entry.strftime("%B %d, %Y") %></strong> which is
                  <% if (@user.latest_entry - next_e).to_i >= 0%>
                    <span class="label label-success">OK</span></p>
                    <p>You will be able to stay <strong><%= @user.remaining_time(@user.latest_entry, true) %></strong> days.</p>
                    <p>You will have to leave on <strong><span id="leave_on"><%= (@user.latest_entry + @user.remaining_time(@user.latest_entry, true) - 1).strftime("%B %d, %Y") %></span></strong> or before.</p>
                  <% else %>
                    <span class="label label-danger">NOT OK</span> - you will be denied entry.
                  <% end %>
                </p>

              <% else %>
                <p>You plan to enter on <strong><%= @user.latest_entry.strftime("%B %d, %Y") %></strong></p>
                <p>You will be able to stay: <strong><span id="remaining_time"><%= @user.remaining_time(@user.next_entry, true) %></span></strong> days</p>
                <p>You will have to leave on <strong><span id="leave_on"><%= @user.latest_exit %></span></strong> or before</p>
              <% end %>
            <% end %>
          </div>
        <% end %>
        <!-- Results -->

        <!-- All previous stays -->
        <div id="all_stays" class="padded">

          <strong>Please enter all your stays in Turkey between <%= @oldest_date %> (included) and your latest or planned entry (not included)</strong>

          <div class="mini-padded">
            <table class="table tablebordered table-condensed">
              <thead>
                <tr>
                  <th>Entry Date</th>
                  <th>Exit Date</th>
                  <th>Number of Days</th>
                  <th></th>
                </tr>
              </thead>
              <tbody>
                <% if @periods.empty? %>
                  <tr id="no_periods"><td class="active" colspan="4">You did not enter any stay yet</td></tr>
                <% end %>
                <%= render "periods/all_periods", periods: @periods %>
              </tbody>
            </table>
          </div>

          <div id="new_period_form">
            <label>Add a stay</label>
            <%= render "periods/form", period: Period.new() %>
          </div>

        </div>
        <!-- All previous stays -->

        <!-- User is in? -->
        <%= form_for(@user, url: users_latest_entry_path) do |f| %>
          <div class="form-group" id="inside_last_entry">
            <label for="last_entry">Latest or planned Entry</label>
            <%= f.text_field :latest_entry, id: "user_last_entry", class: "form-control latest_planned", placeholder: "Click to Select", value: @latest_entry, required: "required" %>
          </div>

          <button id="calculate" type="submit" class="btn btn-success" disabled="disabled">Calculate</button>
        <% end %>
        <!-- User is in? -->

        <div id="disclaimer" class="marged bg-info">
          <small>
            <p><strong>Disclaimer</strong></p>
            <p>With our Visa Calculator, you can enter all the information about your past and projected trip days, and figure out if you are following the rules and not overstaying on your trips in Turkey.</p>

            <p>Our service is provided as is. It is not linked in any way to any official authorities. We will not accept any liability for any negative effects of any nature its use may have.</p>

            <p><strong>Credit</strong></p>
            <p>Logo: Created by Yazmin Alanis, from the Noun Project</p>
          </small>
        </div>

    </div>
  </div>
</div>